###################################################
#
# File: Common-Include/Stop-Agent
# Contains:
#   stop operator
#  
###################################################

###################################################
#	stop operator
#
#	When there is a flag on the top state called
#	"stop-agent" with value YES, this operator is
#	proposed with best preference and selected to
#	stop the robot.
###################################################

# Proposal Rule
sp {Common-Include*Stop-Agent*propose*stop
	(state <s>	^name line-follower
				^stop-agent YES)
-->
	(<s>	^operator <o> + >)
	(<o>	^name stop)
}

# Apply rule

# This puts on the output link a command
# to each motor to have it stop.  Even if
# we know there isn't a motor connected to
# that port, we tell it to stop as this
# is a generic rule and will work no matter
# how many motors we have plugged in to the
# motor ports.

sp {Common-Include*Stop-Agent*apply*stop
	(state <s>	^name line-follower
				^operator.name stop
				^stop-agent YES
				^io.output-link <out>)
-->
	(<s> ^stop-agent YES -)
  (<out>	^motor <A> <B> <C> <D>)
  (<A> ^port A 
        ^set-power 0)
  (<B> ^port B
        ^set-power 0)
  (<C> ^port C
        ^set-power 0)
  (<D> ^port D
        ^set-power 0)
}
